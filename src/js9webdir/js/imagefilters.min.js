var ImageFilters;
ImageFilters=function(){function D(b){var d;var a=b.reduce(function(a,b){return a+b});for(d=0;d<b.length;++d)b[d]/=a}function h(b,d,a,c,e){var f,g,k,l,r,z,q,n=Math.round(Math.sqrt(a.length)),u=Math.floor(n/2),m=d.width,v=d.height;var p=m*v*4;var h=d.data;b=b.createImageData(d.width,d.height);for(f=0;f<p;f++)b[f]=h[f];if("[object Array]"!==Object.prototype.toString.call(a))return d;void 0===c&&(c=!0);c=c?1:0;e&&D(a);for(p=0;p<v;p++)for(e=0;e<m;e++){var x=p;f=e;var w=4*(p*m+e);for(k=q=z=r=l=0;k<n;k++)for(g=
0;g<n;g++){var t=Math.min(v-1,Math.max(0,x+k-u));var y=Math.min(m-1,Math.max(0,f+g-u));y=4*(t*m+y);t=a[k*n+g];l+=b[y]*t;r+=b[y+1]*t;z+=b[y+2]*t;q+=b[y+3]*t}h[w]=l;h[w+1]=r;h[w+2]=z;h[w+3]=q+c*(255-q)}return d}function A(b,d,a,c){var e,f,g,k,l,r,h;b=Math.round(Math.sqrt(a.length));var q=Math.floor(b/2),n=d.data,u=d.width;d=d.height;var m=new Float32Array(u*d*4),v=c?1:0;for(e=0;e<d;e++)for(c=0;c<u;c++){var p=e;var A=c;var x=4*(e*u+c);for(g=h=r=l=k=0;g<b;g++)for(f=0;f<b;f++){var w=Math.min(d-1,Math.max(0,
p+g-q));var t=Math.min(u-1,Math.max(0,A+f-q));t=4*(w*u+t);w=a[g*b+f];k+=n[t]*w;l+=n[t+1]*w;r+=n[t+2]*w;h+=n[t+3]*w}m[x]=k;m[x+1]=l;m[x+2]=r;m[x+3]=h+v*(255-h)}return m}function B(b,d){var a=d.data;for(b=0;b<a.length;b+=4){var c=.299*a[b]+.587*a[b+1]+.114*a[b+2];a[b]=a[b+1]=a[b+2]=c}return d}function C(b,d){var a=d.data;for(b=0;b<a.length;b+=4){var c=(a[b]+a[b+1]+a[b+2])/3;a[b]=a[b+1]=a[b+2]=c}return d}return{convolve:h,luminance:function(b,d){var a=d.data;for(b=0;b<a.length;b+=4){var c=.2126*a[b]+
.7152*a[b+1]+.0722*a[b+2];a[b]=a[b+1]=a[b+2]=c}return d},greyscale:B,greyscaleAvg:C,brighten:function(b,d,a){var c=d.data;a=a||10;for(b=0;b<c.length;b+=4)c[b]+=a,c[b+1]+=a,c[b+2]+=a;return d},noise:function(b,d,a,c){var e,f=d.data;3>arguments.length&&(a=-30,c=30);var g=c-a;for(e=0;e<f.length;e+=4){var k=Math.floor(Math.random()*g-c);f[e]+=k;f[e+1]+=k;f[e+2]+=k}return d},duotone:function(b,d,a){var c=d.data;switch(a){case "r":a=0;break;case "g":a=1;break;case "b":a=2;break;default:a=0}for(b=0;b<c.length;b+=
4){var e=(c[b]+c[b+1]+c[b+2]-c[b+a])/2;c[b+a]=e}return d},invert:function(b,d){var a=d.data;for(b=0;b<a.length;b+=4)a[b]=255-a[b],a[b+1]=255-a[b+1],a[b+2]=255-a[b+2];return d},pixelate:function(b,d,a){var c,e,f,g,k=d.width,l=d.height,r=d.data;3>arguments.length&&(a=2);var h=2*a;for(e=a;e<l-a;e+=h)for(c=a;c<k-a;c+=h){var q=4*(k*e+c);var n=r[q];var u=r[q+1];q=r[q+2];for(g=-a;g<a;++g){var m=k*(e+g);for(f=-a;f<a;++f){var v=4*(m+(c+f));r[v]=n;r[v+1]=u;r[v+2]=q}}}return d},sobel:function(b,d,a){var c=d.data;
d=C(b,d);var e=A(b,d,[-1,0,1,-2,0,2,-1,0,1]);var f=A(b,d,[-1,-2,-1,0,0,0,1,2,1]);if(a)for(a=0;a<c.length;a+=4){var g=Math.abs(f[a]);var k=Math.abs(e[a]);c[a]=g;c[a+1]=k;c[a+2]=(g+k)/4}else{for(a=0;a<c.length;a+=4)g=Math.abs(f[a]),k=Math.abs(e[a]),c[a]=g,c[a+1]=k,c[a+2]=(g+k)/2;B(b,d)}return d},medianFilter:function(b,d){return h(b,d,[1,0,0,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,0,0,0,1],!0,!0)},sepia:function(b,d){var a=d.data;for(b=0;b<a.length;b+=4){var c=a[b];var e=a[b+1];var f=a[b+2];a[b]=.393*c+
.769*e+.189*f;a[b+1]=.349*c+.686*e+.168*f;a[b+2]=.272*c+.534*e+.131*f}return d},contrast:function(b,d,a){var c,e=d.data;3>arguments.length&&(a=2);-100>a?a=-100:100<a&&(a=100);for(c=0;c<e.length;c+=4)e[c]=255*((e[c]/255-.5)*a+.5),e[c+1]=255*((e[c+1]/255-.5)*a+.5),e[c+2]=255*((e[c+2]/255-.5)*a+.5);return d},threshold:function(b,d,a,c,e){var f,g=d.data;3>arguments.length?(a=10,c=0,e=255):5>arguments.length&&(c=0,e=255);for(f=0;f<g.length-1;f+=4){var k=g[f];var l=g[f+1];var h=g[f+2];k=.2126*k+.7152*l+
.0722*h>=a?e:c;g[f]=g[f+1]=g[f+2]=k}return d},gamma:function(b,d,a){var c,e=d.data;3>arguments.length&&(a=.2);for(c=0;c<e.length;c+=4)e[c]=255*Math.pow(e[c]/255,a),e[c+1]=255*Math.pow(e[c+1]/255,a),e[c+2]=255*Math.pow(e[c+2]/255,a);return d},gaussBlur5:function(b,d){return h(b,d,[.003,.0133,.0219,.0133,.003,.0133,.0596,.0983,.0596,.0133,.0219,.0983,.1621,.0983,.0219,.0133,.0596,.0983,.0596,.0133,.003,.0133,.0219,.0133,.003])},posterize:function(b,d,a){var c,e=[];var f=1;var g=d.data;3>arguments.length&&
(a=40);for(c=0;256>c;++c)c<a*f?e[c]=a*(f-1):(e[c]=a*f,++f);for(c=0;c<g.length;c+=4){f=g[c];var k=g[c+1];var l=g[c+2];g[c]=e[f];g[c+1]=e[k];g[c+2]=e[l]}return d},scatter:function(b,d,a){var c,e,f,g=d.width,k=d.height,l=d.data;3>arguments.length&&(a=5);var h=2*a;var z=(a-1)*a;for(e=a;e<k-a;e+=h)for(c=a;c<g-a;c+=h){var q=!1;for(f=0;!q;){var n=Math.floor(Math.random()*h-a);var u=Math.floor(Math.random()*h-a);var m=Math.floor(Math.random()*h-a);var v=Math.floor(Math.random()*h-a);var p=[];n=4*(g*(u+e)+
(n+c));m=4*(g*(v+e)+(m+c));p[0]=l[n];p[1]=l[n+1];p[2]=l[n+2];p[3]=l[n+3];l[n]=l[m];l[n+1]=l[m+1];l[n+2]=l[m+2];l[n+3]=l[m+3];l[m]=p[0];l[m+1]=p[1];l[m+2]=p[2];l[m+3]=p[3];++f;f>z&&(q=!0)}}return d},solarize:function(b,d,a){var c,e=d.data;3>arguments.length&&(a=50);for(c=0;c<e.length;++c){var f=e[c];var g=e[c+1];var k=e[c+2];var h=(f+g+k)/3;h<a&&(e[c]=255-f,e[c+1]=255-g,e[c+2]=255-k)}return d},sharpen:function(b,d,a){3>arguments.length&&(a=20);return h(b,d,[0,-3,0,-3,a,-3,0,-3,0],!0,!0)},edgeDetect:function(b,
d){return h(b,d,[-1,-1,-1,-1,8,-1,-1,-1,-1])},blur:function(b,d){return h(b,d,[1,2,1,2,1,2,1,2,1],!0,!0)},emboss:function(b,d,a){3>arguments.length&&(a=95);return h(b,d,[-18,-9,9,-9,100-a,9,0,9,18],!0,!0)},lighten:function(b,d,a){if(3>arguments.length||0>a)a=12/9;return h(b,d,[0,0,0,0,a,0,0,0,0])},darken:function(b,d,a){if(3>arguments.length||1<a)a=6/9;return h(b,d,[0,0,0,0,a,0,0,0,0])}}}();
